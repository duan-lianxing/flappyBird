!function(){var t=window.Game=function(t){this.canvas=document.querySelector(t.id),this.ctx=this.canvas.getContext("2d"),this.Rjsonurl=t.Rjsonurl,this.init(),this.score=0;var e=this;e.fno=0,this.loadAllResource(function(){e.start()})};t.prototype.init=function(){var t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;t>400?t=400:t<320&&(t=320),e>736?e=736:e<500&&(e=500),this.canvas.width=t,this.canvas.height=e},t.prototype.loadAllResource=function(t){this.R={};var e=this,n=0,a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState)for(var i=JSON.parse(a.responseText),s=0;s<i.images.length;s++)e.R[i.images[s].name]=new Image,e.R[i.images[s].name].src=i.images[s].url,e.R[i.images[s].name].onload=function(){n++,e.ctx.clearRect(0,0,e.canvas.width,e.canvas.height);var a="正在加载"+n+"/"+i.images.length+"请稍后";e.ctx.textAlign="center",e.ctx.font="20px ΢微软雅黑",e.ctx.fillText(a,e.canvas.width/2,.382*e.canvas.height),n==i.images.length&&t.call(e)}},a.open("get","R.json",!0),a.send(null)},t.prototype.start=function(){this.sm=new SceneManager;var t=this;this.timer=setInterval(function(){t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.fno+=1,t.sm.update(),t.sm.render(),t.ctx.textAlign="left",t.ctx.font="16px ΢consolas",t.ctx.fillText("FNO："+t.fno,10,20),t.ctx.fillText("场景编号："+t.sm.sceneNumber,10,40)},20)}}();
!function(){var e=window.SceneManager=function(){this.sceneNumber=1,game.bg=new Background,game.bird=new Bird,game.land=new Land,this.titleY=-48,this.button_playX=game.canvas.width/2-58,this.button_playY=game.canvas.height,this.bindEvent()};e.prototype.update=function(){switch(this.sceneNumber){case 1:this.titleY+=5,this.titleY>160&&(this.titleY=160),this.button_playY-=10,this.button_playY<300&&(this.button_playY=300);break;case 2:game.bird.wing(),this.tutorialOpacity+=this.tutorialOpacityIsDown?-.1:.1,(this.tutorialOpacity<.1||this.tutorialOpacity>.9)&&(this.tutorialOpacityIsDown=!this.tutorialOpacityIsDown);break;case 3:game.bird.update(),game.bg.update(),game.land.update(),game.fno%150==0&&new Pipe;for(var e=0;e<game.pipeArr.length;e++)game.pipeArr[e]&&game.pipeArr[e].update();break;case 4:game.bird.y>.75*game.canvas.height-24&&(this.isBirdLand=!0),this.birdfno++,this.isBirdLand?game.fno%4==0&&this.bombStep++:game.bird.y+=10*this.birdfno,this.maskOpacity-=.1,this.maskOpacity<0&&(this.maskOpacity=0)}},e.prototype.render=function(){switch(this.sceneNumber){case 1:game.bg.render(),game.land.render(),game.bird.render(),game.bird.x=game.canvas.width/2,game.bird.y=270,game.ctx.drawImage(game.R.title,game.canvas.width/2-89,this.titleY),game.ctx.drawImage(game.R.button_play,this.button_playX,this.button_playY);break;case 2:game.bg.render(),game.land.render(),game.bird.render(),game.bird.y=150,game.ctx.save(),game.ctx.globalAlpha=this.tutorialOpacity,game.ctx.drawImage(game.R.tutorial,game.canvas.width/2-57,220),game.ctx.restore();break;case 3:game.bg.render(),game.land.render(),game.bird.render();for(t=0;t<game.pipeArr.length;t++)game.pipeArr[t]&&game.pipeArr[t].render();for(var e=game.score.toString().length,a=0;a<e;a++)game.ctx.drawImage(game.R["font"+game.score.toString().charAt(a)],game.canvas.width/2-e/2*34+34*a+5,100);break;case 4:game.bg.render(),game.land.render(),this.isBirdLand?this.bombStep<=11?game.ctx.drawImage(game.R["b"+this.bombStep],game.bird.x-24-36,game.bird.y-24-100):this.enter(5):game.bird.render();for(t=0;t<game.pipeArr.length;t++)game.pipeArr[t]&&game.pipeArr[t].render();game.ctx.fillStyle="rgba(255,255,255,"+this.maskOpacity+")",game.ctx.fillRect(0,0,game.canvas.width,game.canvas.height);for(var e=game.score.toString().length,a=0;a<e;a++)game.ctx.drawImage(game.R["font"+game.score.toString().charAt(a)],game.canvas.width/2-e/2*34+34*a+5,100);break;case 5:game.bg.render(),game.land.render();for(var t=0;t<game.pipeArr.length;t++)game.pipeArr[t]&&game.pipeArr[t].render();for(var e=game.score.toString().length,a=0;a<e;a++)game.ctx.drawImage(game.R["font"+game.score.toString().charAt(a)],game.canvas.width/2-e/2*34+34*a+5,100);game.ctx.drawImage(game.R.text_game_over,game.canvas.width/2-102,200)}},e.prototype.enter=function(e){switch(this.sceneNumber=e,this.sceneNumber){case 1:this.titleY=-48,this.button_play=Ygame.canvas.height,game.bird=new Bird;break;case 2:game.bird.y=150,this.tutorialOpacity=1,this.tutorialOpacityIsDown=!0;break;case 3:game.pipeArr=new Array;break;case 4:this.maskOpacity=1,this.isBirdLand=!1,this.birdfno=0,this.bombStep=0}},e.prototype.bindEvent=function(){function e(e,t){switch(a.sceneNumber){case 1:this.titleY=-48,e>a.button_playX&&e<a.button_playX+116&&t>a.button_playY&&t<a.button_playY+70&&a.enter(2);break;case 2:a.enter(3);break;case 3:game.bird.fly();break;case 5:a.enter(1)}}var a=this;game.canvas.addEventListener("touchstart",function(a){var t=a.touches[0];e(t.clientX,t.clientY)},!0)}}();
!function(){var t=window.Background=function(){this.image=game.R.bg_day,this.y=.75*game.canvas.height-396,this.x=0,this.w=288,this.h=512,this.spead=1};t.prototype.update=function(){this.x-=this.spead,this.x<-this.w&&(this.x=0)},t.prototype.render=function(){game.ctx.drawImage(this.image,this.x,this.y),game.ctx.drawImage(this.image,this.x+this.w,this.y),game.ctx.drawImage(this.image,this.x+2*this.w,this.y),game.ctx.fillStyle="#4ec0ca",game.ctx.fillRect(0,0,game.canvas.width,this.y+1),game.ctx.fillStyle="#5EE270",game.ctx.fillRect(0,this.y+this.h,game.canvas.width,game.canvas.height-this.h)}}();
!function(){var t=window.Bird=function(){this.color=parseInt(3*Math.random()),this.imageArr=[game.R["bird"+this.color+"_0"],game.R["bird"+this.color+"_1"],game.R["bird"+this.color+"_2"]],this.wingStep=0,this.x=.382*game.canvas.width-24,this.y=100,this.fno=0,this.d=0,this.hasEnergy=!1};t.prototype.update=function(){this.wing(),this.hasEnergy?(this.y-=.2*(20-this.fno),this.fno>20&&(this.hasEnergy=!1,this.fno=0)):this.y+=.1*this.fno,this.d+=.03,this.fno++,this.y<0&&(this.y=0),this.T=this.y-12,this.R=this.x+17,this.B=this.y+12,this.L=this.x-17,this.B>.75*game.canvas.height&&game.sm.enter(4)},t.prototype.render=function(){game.ctx.save(),game.ctx.translate(this.x,this.y),game.ctx.rotate(this.d),game.ctx.drawImage(this.imageArr[this.wingStep],-24,-24),game.ctx.restore()},t.prototype.fly=function(){this.hasEnergy=!0,this.d=-.6,this.fno=0},t.prototype.wing=function(){game.fno%10==0&&this.wingStep++,this.wingStep>2&&(this.wingStep=0)}}();
!function(){var t=window.Land=function(){this.image=game.R.land,this.y=.75*game.canvas.height,this.x=0,this.w=336};t.prototype.update=function(){this.x-=2,this.x<-336&&(this.x=0)},t.prototype.render=function(){game.ctx.drawImage(this.image,this.x,this.y),game.ctx.drawImage(this.image,this.x+this.w,this.y),game.ctx.drawImage(this.image,this.x+2*this.w,this.y),game.ctx.fillStyle="#DED895",game.ctx.fillRect(0,this.y+112,game.canvas.width,game.canvas.height)}}();
!function(){var i=window.Pipe=function(){this.imagedown=game.R.pipe_down,this.imageup=game.R.pipe_up,this.allheight=.75*game.canvas.height,this.interspace=150,this.picheight=320,this.upheight=50+parseInt(Math.random()*(this.picheight-50)),this.downheight=this.allheight-this.upheight-this.interspace,this.x=game.canvas.width,this.alreadyPass=!1,game.pipeArr.push(this)};i.prototype.update=function(){if(this.x-=2,game.bird.R>this.x&&game.bird.L<this.x+52&&(game.bird.T<this.upheight||game.bird.B>this.upheight+this.interspace)&&game.sm.enter(4),game.bird.R>this.x+52&&!this.alreadyPass&&(game.score++,this.alreadyPass=!0),this.x<-52)for(var i=0;i<game.pipeArr.length;i++)game.pipeArr[i]===this&&game.pipeArr.splice(i,1)},i.prototype.render=function(){game.ctx.drawImage(this.imagedown,0,this.picheight-this.upheight,52,this.upheight,this.x,0,52,this.upheight),game.ctx.drawImage(this.imageup,0,0,52,this.downheight,this.x,this.interspace+this.upheight,52,this.downheight)}}();